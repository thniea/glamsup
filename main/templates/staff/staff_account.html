{% extends "base_staff.html" %}
{% load static %}

{% block title %}Staff · Account Overview{% endblock %}

{% block head_extra %}
<style>
  /* giống style account customer */
  .account-sidebar .avatar{
    width:72px;height:72px;border-radius:50%;
    border:3px solid #fff;object-fit:cover;background:#f6f6f6;
  }
  .account-menu a{ display:flex;align-items:center;gap:.6rem;padding:.55rem .9rem;border-radius:10px;font-weight:800;color:var(--ink); text-decoration:none; }
  .account-menu a .mi{ width:1.4rem; text-align:center; font-size:1.1rem; color:#6b705c; }
  .account-menu a:hover{ background:#eef1dd; }
  .account-menu a.active{ background:#eef1dd; box-shadow:inset 0 0 0 2px var(--edge); }

  .panel{ position:relative; margin-bottom:1.25rem; }
  .panel-header{
    background:var(--brand); color:#111; font-weight:900; font-size:1.05rem;
    padding:.65rem .9rem; border-radius:10px 10px 0 0; border:2px solid var(--edge); border-bottom:none;
    display:flex; align-items:center; justify-content:space-between;
  }
  .panel-body{
    padding:1rem 1.1rem; border:2px solid var(--edge); border-top:none;
    border-radius:0 0 10px 10px; background:#fff;
  }
  .panel-actions{ display:flex; gap:.5rem; }

  .kv{ display:grid; grid-template-columns:220px 1fr; row-gap:.4rem; }
  @media (max-width: 991px){ .kv{ grid-template-columns:1fr; } }

  .badge-tier{ background:#868b61; color:#fff; font-weight:800; border-radius:8px; padding:.1rem .5rem; }

  .btn-soft{
    background:#eef1dd; border:1px solid var(--edge); border-radius:999px;
    padding:.35rem .9rem; font-weight:800; font-size:.85rem; color:var(--ink);
  }
  .btn-soft:hover{ background:#e3e7cc; }

</style>
{% endblock %}

{% block content %}
<div class="row g-4">
  <!-- Sidebar -->
  <div class="col-lg-3 col-md-4">
    {% include "includes/_sidebar_staff.html" with active="account" %}
  </div>

  <!-- Main -->
  <div class="col-md-8 col-lg-9 d-grid gap-4">

    <!-- Account information -->
    <div class="panel">
      <div class="panel-header">
        <span>Account information</span>
        <div class="panel-actions">
          <button class="btn btn-soft btn-sm" data-bs-toggle="modal" data-bs-target="#changePwdModal">
            Change password
          </button>
          <button class="btn btn-soft btn-sm" data-bs-toggle="modal" data-bs-target="#editAccountModal">
            Edit Account
          </button>
        </div>
      </div>
      <div class="panel-body">
        <div class="kv">
          <div>Account name</div>
          <div class="fw-semibold">
            {{ staff.full_name|default:request.user.full_name|default:request.user.username }}
          </div>

          <div>Password</div><div>**********</div>

          <div>Email</div>
          <div>{{ staff.email|default:request.user.email|default:"—" }}</div>
        </div>
      </div>
    </div>

    <!-- Personal Information -->
    <div class="panel">
      <div class="panel-header">
        <span>Personal Information</span>
        <div class="panel-actions">
          <button class="btn btn-soft btn-sm" data-bs-toggle="modal" data-bs-target="#editPersonalModal">
            Edit Personal
          </button>
        </div>
      </div>
      <div class="panel-body">
        <div class="kv">
          <div>Full name</div>
          <div class="fw-semibold">{{ staff.full_name|default:"—" }}</div>

          <div>Email</div><div>{{ staff.email|default:"—" }}</div>

          <div>Phone number</div><div>{{ staff.phone|default:"—" }}</div>

          <div>Address</div><div>{{ staff.address|default:"—" }}</div>

          <div>Date of birth</div>
          <div>{% if staff.dob %}{{ staff.dob|date:"d/m/Y" }}{% else %}—{% endif %}</div>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- ================= Modals ================= -->

<!-- 1) Edit account -->
<div class="modal fade" id="editAccountModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form class="modal-content" method="post" action="">
      {% csrf_token %}
      <input type="hidden" name="action" value="save_account">
      <div class="modal-header">
        <h5 class="modal-title">Edit Account</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label fw-bold">Full name</label>
          <input type="text" name="full_name" class="form-control" value="{{ request.user.full_name }}">
        </div>
        <div class="mb-3">
          <label class="form-label fw-bold">Email</label>
          <input type="email" name="email" class="form-control" value="{{ request.user.email }}">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-brand">Save changes</button>
      </div>
    </form>
  </div>
</div>

<!-- 2) Edit personal information -->
<div class="modal fade" id="editPersonalModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form class="modal-content" method="post" action="">
      {% csrf_token %}
      <input type="hidden" name="action" value="save_personal">
      <div class="modal-header">
        <h5 class="modal-title">Edit Personal</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label fw-bold">Phone number</label>
          <input type="text" name="phone_number" class="form-control" value="{{ request.user.phone_number }}">
        </div>
        <div class="mb-3">
          <label class="form-label fw-bold">Address</label>
          <input type="text" name="address" class="form-control" value="{{ request.user.address }}">
        </div>
        <div class="mb-3">
          <label class="form-label fw-bold">Date of birth</label>
          <input type="date" name="date_of_birth" class="form-control"
                 value="{{ staff.dob|date:'Y-m-d' }}">
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-brand">Save changes</button>
      </div>
    </form>
  </div>
</div>

<!-- 3) Change password -->
<div class="modal fade" id="changePwdModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <form class="modal-content" method="post" action="">
      {% csrf_token %}
      <input type="hidden" name="action" value="change_password">
      <div class="modal-header">
        <h5 class="modal-title">Change password</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label fw-bold">Current password</label>
          <input type="password" name="old_password" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label fw-bold">New password</label>
          <input type="password" name="new_password1" class="form-control" required>
          <div class="form-text">Mật khẩu đủ mạnh (tối thiểu 8 ký tự, khó đoán…).</div>
        </div>
        <div class="mb-1">
          <label class="form-label fw-bold">Confirm new password</label>
          <input type="password" name="new_password2" class="form-control" required>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-brand">Update password</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}
