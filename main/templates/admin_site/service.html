{% extends "base_admin.html" %}
{% load static humanize %}

{% block title %}Service Management · Glamup Nails{% endblock %}

{% block head_extra %}
<style>
  :root{
    --cat-mani:#c8e6c9;
    --cat-pedi:#f8bbd0;
    --cat-more:#d7ccc8;
  }
  body{ background:var(--bg); font-family:'Nunito',sans-serif; }
  .title{ font-weight:900; letter-spacing:.5px; }
  .thumb{ width:44px; height:44px; border-radius:10px; object-fit:cover; border:2px solid var(--brand); }

  .status-chip{
    display:inline-block; background:#eef3db; border:1px solid var(--brand);
    border-radius:999px; padding:.25rem .6rem; font-weight:700; font-size:.9rem;
  }
  .status-out{ background:#fdeeee; border-color:#f5b1b1; }

  .cat-chip{
    display:inline-block; padding:.25rem .7rem; border-radius:999px;
    font-weight:700; font-size:.9rem; border:1px solid #999; text-transform:capitalize;
  }
  .cat-mani{ background:var(--cat-mani); border-color:#81c784; }
  .cat-pedi{ background:var(--cat-pedi); border-color:#f48fb1; }
  .cat-more{ background:var(--cat-more); border-color:#a1887f; }

  /* Nút delete */
  .btn-del {
    border-radius:999px;
    border:2px solid #e29b9b;
    background:#fff5f5;
    color:#b64747;
    font-weight:700;
    padding:.2rem .8rem;
    font-size:.8rem;
  }
  .btn-del:hover{
    background:#ffe1e1;
  }

  /* Nhóm 2 nút Update: Edit + Delete thành 2 “cột” cố định */
  .update-actions{
    display: grid;
    grid-template-columns: 80px 80px;  /* mỗi nút 80px */
    justify-content: center;           /* căn cụm nút vào giữa cột Update */
    column-gap: 8px;                   /* khoảng cách giữa Edit & Delete */
  }

  .update-actions .btn{
    width: 100%;
    text-align: center;
  }
  /* FIX lệch nút Edit & Delete (do line-height / padding khác nhau) */
  .update-actions .btn {
    height: 32px;            /* giữ chiều cao đồng nhất */
    display: flex;
    align-items: center;     /* căn nút Edit vào giữa */
    justify-content: center; /* căn text giữa */
    padding-top: 0;          /* xoá padding thừa */
    padding-bottom: 0;
  }

</style>
{% endblock %}

{% block content %}
<div class="row g-4">

  <div class="col-lg-3 col-md-4">
    {% include 'includes/_sidebar_admin.html' with active='service' %}
  </div>

  <div class="col-lg-9 col-md-8">
<h1 class="h4 mb-3 fw-bold text-center">SERVICE MANAGEMENT</h1>
    <div class="row g-2 align-items-end mb-3">
      <div class="col-md-4">
        <button class="btn btn-outline-brand w-100 d-flex align-items-center justify-content-center"
                data-bs-toggle="modal" data-bs-target="#addModal">
          <i class="bi bi-plus-lg me-2"></i> Add New Service
        </button>
      </div>

      <div class="col-md-4 ms-auto">
        <form method="get">
          <div class="input-group">
            <input name="q" value="{{ q }}" class="form-control" placeholder="Search service…">
            <button class="btn btn-outline-secondary" aria-label="Search">
              <i class="bi bi-search"></i>
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="text-muted small mb-2">Total ({{ total|default:0 }})</div>

    <div class="card border-2">
      <div class="table-responsive">
        <table class="table align-middle m-0">
          <thead class="table-light">
            <tr>
              <th>Name</th>
              <th style="width:120px;">Picture</th>
              <th style="width:140px;">Price</th>
              <!-- >>> thêm cột Duration -->
              <th style="width:120px;">Duration</th>
              <th style="width:140px;">Category</th>
              <th style="width:160px;">Order status</th>
              <th style="width:180px;" class="text-center">Update</th>
            </tr>
          </thead>
          <tbody>
            {% if services %}
              {% for s in services %}
              <tr>
                <td class="fw-semibold">{{ s.name|default:'Unnamed' }}</td>
                <td>
                  <img class="thumb" src="{{ s.thumbnail_url|default:'/static/images/placeholder.png' }}" alt="">
                </td>
                <td>
                  {% with p=s.price|floatformat:0 %}
                    {% if p %}{{ p|intcomma }} VND{% else %}0 VND{% endif %}
                  {% endwith %}
                </td>
                <!-- >>> hiển thị Duration -->
                <td>{{ s.duration|default:60 }}’</td>
                <td>
                  {% with cat=s.category|default:"more" %}
                    <span class="cat-chip {% if cat == 'manicure' %}cat-mani{% elif cat == 'pedicure' %}cat-pedi{% else %}cat-more{% endif %}">
                      {{ cat|title }}
                    </span>
                  {% endwith %}
                </td>
                <td>
                  {% if s.is_active %}
                    <span class="status-chip">In Stock</span>
                  {% else %}
                    <span class="status-chip status-out">Out of Stock</span>
                  {% endif %}
                </td>
                <td class="text-center">
                  <div class="update-actions">
                    <!-- Edit -->
                    <a class="btn btn-sm btn-outline-brand"
                       href="{% url 'main:admin_service_edit' s.id %}">
                      Edit
                    </a>

                    <!-- Delete -->
                    <form action="{% url 'main:admin_service_delete' s.id %}"
                          method="post"
                          onsubmit="return confirm('Bạn chắc chắn muốn xóa dịch vụ này?');">
                      {% csrf_token %}
                      <button type="submit" class="btn btn-sm btn-del">
                        Delete
                      </button>
                    </form>
                  </div>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="7" class="text-center py-4 text-muted">No services found.</td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>

      <div class="card-footer bg-transparent">
        {% include 'includes/_pagination.html' with page_obj=page_obj %}
      </div>
    </div>

    <!-- Add New (modal) -->
    <div class="modal fade" id="addModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog">
        <form class="modal-content" method="post" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="modal-header">
            <h5 class="modal-title">Add new service</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body">
            <div class="row g-3">
              <div class="col-12">
                <label class="form-label">Name</label>
                <input name="service_name" class="form-control" required>
              </div>
              <div class="col-md-4">
                <label class="form-label">Price (VND)</label>
                <input type="number" name="price" class="form-control" min="0" step="1000" required>
              </div>
              <!-- >>> thêm ô Duration -->
              <div class="col-md-4">
                <label class="form-label">Duration (minutes)</label>
                <input type="number" name="duration" class="form-control" min="10" step="5" value="60">
              </div>
              <div class="col-md-4">
                <label class="form-label">Order status</label>
                <select name="is_active" class="form-select">
                  <option value="True">In Stock</option>
                  <option value="False">Out of Stock</option>
                </select>
              </div>
              <div class="col-md-4">
                <label class="form-label">Category</label>
                <select name="category" class="form-select">
                  <option value="MANICURE">Manicure (nails tay)</option>
                  <option value="PEDICURE">Pedicure (nails chân)</option>
                  <option value="MORE">More (dịch vụ khác)</option>
                </select>
              </div>
              <div class="col-12">
                <label class="form-label">Thumbnail</label>
                <input type="file" name="image" accept="image/*" class="form-control">
              </div>
              <div class="col-12">
                <label class="form-label">Description (optional)</label>
                <textarea name="description" rows="3" class="form-control"></textarea>
              </div>
            </div>
          </div>
          <div class="modal-footer">
            <button class="btn btn-outline-brand" data-bs-dismiss="modal" type="button">Cancel</button>
            <button class="btn btn-brand" type="submit">Create</button>
          </div>
        </form>
      </div>
    </div>

  </div>
</div>
{% endblock %}
