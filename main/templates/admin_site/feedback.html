{% extends "base_admin.html" %}
{% load static %}

{% block title %}Backoffice · Feedback Review{% endblock %}

{% block head_extra %}
<style>
  :root{ --brand:#a5aa7f; --bg:#f6f5ec; --olive:#2b3220; --edge:#a5aa7f; }
  body{ background:var(--bg); font-family:'Nunito',sans-serif; }

  .page-title{ font-weight:900; letter-spacing:.5px; color:#1e2417; }

  /* Ô chọn ngày + nút filter */
  .date-filter{
    background:#fffef9;
    border:2px solid #cfd3a9;
    border-radius:999px;
    height:40px;
    padding:0 .9rem;
    font-size:.9rem;
  }
  .btn-filter{
    background:var(--brand);
    color:#fff;
    font-weight:800;
    border:none;
    border-radius:999px;
    padding:.4rem 1.3rem;
    box-shadow:0 4px 12px rgba(0,0,0,.08);
    transition:0.2s;
}
.btn-filter:hover{
    filter:brightness(.96);
    color:#fff;
}

  .fb-card{ background:#fdfcf6; border:2px solid #a3a88b; border-radius:12px; padding:1rem; }
  .fb-avatar{ width:38px; height:38px; border-radius:50%; object-fit:cover; border:2px solid #fff; }
  .fb-name{ font-weight:800; font-size:.95rem; }
  .fb-date{ color:#6d7452; font-weight:700; font-size:.9rem; }
  .stars{ color:#ffbf00; font-size:1rem; }
  .fb-photos img{ width:70px; height:70px; object-fit:cover; border-radius:8px; border:2px solid #c9cda9; }

  /* Nút Response giống style Submit */
  .btn-reply{
    background:var(--brand);
    color:#fff;
    font-weight:800;
    border:none;
    border-radius:999px;
    padding:.4rem 1.3rem;
    display:inline-flex;
    align-items:center;
    gap:.35rem;
    box-shadow:0 4px 12px rgba(0,0,0,.08);
  }
  .btn-reply:hover{
    filter:brightness(.97);
    color:#fff;
  }
  .btn-reply i{
    font-size:.9rem;
  }
</style>
{% endblock %}

{% block content %}
<div class="row g-4">
  <!-- Sidebar dùng chung -->
  <div class="col-lg-3 col-md-4">
    {% include 'includes/_sidebar_admin.html' with active='feedback' %}
  </div>

  <!-- Main -->
  <div class="col-lg-9 col-md-8">

 <h1 class="h4 mb-3 fw-bold text-center">FEEDBACK REVIEW</h1>
    {# TOOLBAR: chỉ còn lọc theo ngày + nút Filter bên phải #}
    <div class="d-flex justify-content-end mb-3">
      <form class="d-flex align-items-center gap-2" method="get">
        <input
          class="form-control date-filter"
          type="date"
          name="date"
          value="{{ date }}">
        <button type="submit" class="btn-filter">
          Filter
        </button>
      </form>
    </div>

    {% if feedback_list %}
      {% for fb in feedback_list %}
        <div class="fb-card mb-3">
          <div class="d-flex align-items-start gap-2">
            <img src="{{ fb.customer.avatar_url }}" class="fb-avatar" alt="">
            <div class="flex-grow-1">
              <div class="d-flex align-items-center gap-2">
                <div class="fb-name">
                  {{ fb.customer.full_name|default:fb.customer.username }}
                </div>

                {# Sao theo fb.rating (1–5) #}
                {% with r=fb.rating|default:0 %}
                  <div class="stars" aria-label="{{ r }} out of 5">
                    {% for _ in "12345"|make_list %}
                      {% if forloop.counter <= r %}
                        <i class="bi bi-star-fill"></i>
                      {% else %}
                        <i class="bi bi-star"></i>
                      {% endif %}
                    {% endfor %}
                  </div>
                {% endwith %}
              </div>

              <div class="fb-date">{{ fb.review_date|date:"Y-m-d" }}</div>

              <p class="mb-2">{{ fb.comment }}</p>

              <div class="d-flex align-items-center justify-content-between">
                <div class="fb-photos d-flex gap-2">
                  {% if fb.image %}
                    <img src="{{ fb.image.url }}" alt="">
                  {% endif %}
                </div>

                <a href="{% url 'main:admin_feedback_reply' fb.id %}"
                   class="btn-reply">
                  <i class="bi bi-send-fill"></i>
                  Response
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-center text-muted mt-4">Chưa có feedback nào.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
