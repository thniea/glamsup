{% extends "base_admin.html" %}
{% load static %}

{% block title %}Backoffice · Feedback Review{% endblock %}

{% block head_extra %}
<style>
  :root{ --brand:#a5aa7f; --bg:#f6f5ec; --olive:#2b3220; --edge:#a5aa7f; }
  body{ background:var(--bg); font-family:'Nunito',sans-serif; }

  /* ===== Style riêng cho page Feedback (sidebar đã có trong base_admin) ===== */
  .page-title{ font-weight:900; letter-spacing:.5px; color:#1e2417; }
  .tool-add{ background:#e1e6cf; border:2px solid #cfd3a9; border-radius:8px; height:40px; }
  .tool-search{ background:#fffef9; border:2px solid #cfd3a9; border-radius:8px; height:40px; padding-left:2.2rem; }
  .search-wrap{ position:relative; }
  .search-wrap .bi-search{ position:absolute; left:.6rem; top:50%; transform:translateY(-50%); color:#6b6f55; }

  .fb-card{ background:#fdfcf6; border:2px solid #a3a88b; border-radius:12px; padding:1rem; }
  .fb-avatar{ width:38px; height:38px; border-radius:50%; object-fit:cover; border:2px solid #fff; }
  .fb-name{ font-weight:800; font-size:.95rem; }
  .fb-date{ color:#6d7452; font-weight:700; font-size:.9rem; }
  .stars{ color:#ffbf00; font-size:1rem; }
  .fb-photos img{ width:70px; height:70px; object-fit:cover; border-radius:8px; border:2px solid #c9cda9; }
  .btn-reply{ background:#cfd3a9; color:#fff; font-weight:800; border:none; border-radius:12px; padding:.35rem .8rem; }
</style>
{% endblock %}

{% block content %}
<div class="row g-4">
  <!-- Sidebar dùng chung -->
  <div class="col-lg-3 col-md-4">
    {% include 'includes/_sidebar_admin.html' with active='feedback' %}
  </div>

  <!-- Main -->
  <div class="col-lg-9 col-md-8">
    <h3 class="text-center page-title mb-3">FEEDBACK REVIEW</h3>

    <div class="d-flex justify-content-between align-items-center mb-3">
      <div class="d-flex align-items-center gap-2">
        <button class="btn tool-add d-flex align-items-center px-2">
          <i class="bi bi-plus-lg"></i>
        </button>
        <input class="form-control tool-add" style="width:220px" placeholder="">
      </div>
      <div class="search-wrap" style="width:260px">
        <i class="bi bi-search"></i>
        <input class="form-control tool-search" placeholder="Search">
      </div>
    </div>

    {% if feedback_list %}
      {% for fb in feedback_list %}
        <div class="fb-card mb-3">
          <div class="d-flex align-items-start gap-2">
            <img src="{{ fb.customer.avatar_url }}" class="fb-avatar" alt="">
            <div class="flex-grow-1">
              <div class="d-flex align-items-center gap-2">
                <div class="fb-name">
                  {{ fb.customer.full_name|default:fb.customer.username }}
                </div>

                {# sao theo rating trung bình của feedback đó #}
                <div class="stars" aria-label="{{ fb.rating|floatformat:1 }} out of 5">
                  {% for _ in "12345"|make_list %}
                    {% if forloop.counter <= fb.rating|floatformat:0 %}
                      <i class="bi bi-star-fill"></i>
                    {% else %}
                      <i class="bi bi-star"></i>
                    {% endif %}
                  {% endfor %}
                </div>
              </div>

              <div class="fb-date">{{ fb.review_date|date:"Y-m-d" }}</div>

              <p class="mb-2">{{ fb.comment }}</p>

              <div class="d-flex align-items-center justify-content-between">
                <div class="fb-photos d-flex gap-2">
                  {% if fb.image %}
                    <img src="{{ fb.image.url }}" alt="">
                  {% endif %}
                </div>
                <a href="{% url 'main:admin_feedback_reply' fb.id %}"
                   class="btn btn-reply">
                  Response
                </a>
              </div>
            </div>
          </div>
        </div>
      {% endfor %}
    {% else %}
      <p class="text-center text-muted mt-4">Chưa có feedback nào.</p>
    {% endif %}
  </div>
</div>
{% endblock %}
