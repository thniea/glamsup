{% extends "base.html" %}
{% load i18n %}

{% block title %}Set new password · GlamUp Nails{% endblock %}

{% block head_extra %}
<style>
  :root{ --brand:#a5aa7f; --bg:#f6f5ec; }
  body{ background:var(--bg); }
  .auth-wrap{ padding:2.5rem 0 3.5rem; }
  .auth-card{
    max-width:760px; margin:0 auto; background:#fff;
    border:2px solid #cfd3a9; border-radius:16px; padding:2rem 2rem 2.25rem;
  }
  .auth-title{ font-weight:900; text-align:center; margin:0 0 .5rem; }
  .auth-sub{ text-align:center; color:#6b6f63; margin-bottom:1.25rem; }
  .form-label{ font-weight:800; }
  .auth-input{ width:100%; padding:.7rem .9rem; border:2px solid #cfd3a9; border-radius:12px; font-weight:700; }
  .auth-input:focus{ outline:none; border-color:var(--brand); box-shadow:0 0 0 3px rgba(165,170,127,.25); }
  .btn-brand{ background:var(--brand); color:#111; font-weight:900; border:2px solid #a5aa7f; border-radius:999px; padding:.75rem 1rem; }
</style>
{% endblock %}

{% block content %}
<div class="container auth-wrap">
  <div class="auth-card">
    {% if validlink %}
      <h1 class="auth-title">{% translate "Set a new password" %}</h1>
      <p class="auth-sub">{% translate "Please enter your new password twice so we can verify you typed it in correctly." %}</p>

      <form method="post" novalidate>
        {% csrf_token %}
        <input type="text" class="d-none" autocomplete="username" value="{{ form.user.get_username }}">
        {% if form.new_password1.errors %}
          <div class="alert alert-danger small mb-3">{{ form.new_password1.errors|striptags }}</div>
        {% endif %}
        {% if form.new_password2.errors %}
          <div class="alert alert-danger small mb-3">{{ form.new_password2.errors|striptags }}</div>
        {% endif %}

        <div class="mb-3">
          <label class="form-label" for="{{ form.new_password1.id_for_label }}">{% translate 'New password' %}</label>
          {{ form.new_password1 }}
        </div>
        <div class="mb-4">
          <label class="form-label" for="{{ form.new_password2.id_for_label }}">{% translate 'Confirm password' %}</label>
          {{ form.new_password2 }}
        </div>

        <div class="d-grid">
          <button class="btn btn-brand btn-lg" type="submit">{% translate 'Change my password' %}</button>
        </div>
      </form>
    {% else %}
      <h1 class="auth-title">{% translate "Link invalid" %}</h1>
      <p class="auth-sub">
        {% translate "The password reset link was invalid, possibly because it has already been used. Please request a new password reset." %}
      </p>
      <div class="text-center">
        <a href="{% url 'password_reset' %}" class="btn btn-brand">{% translate 'Request new link' %}</a>
      </div>
    {% endif %}
  </div>
</div>

<script>
  // thêm class đẹp cho 2 input
  const p1 = document.getElementById('{{ form.new_password1.id_for_label }}');
  const p2 = document.getElementById('{{ form.new_password2.id_for_label }}');
  if(p1){ p1.classList.add('auth-input'); p1.setAttribute('autocomplete','new-password'); }
  if(p2){ p2.classList.add('auth-input'); p2.setAttribute('autocomplete','new-password'); }
</script>
{% endblock %}
