{% extends "base_customer.html" %}
{% load humanize %}

{% block title %}Reward points · Glamup Nails{% endblock %}

{% block head_extra %}
<style>
  .loyalty-wrap{max-width:980px;margin:24px auto 40px;}
  .page-title{
    font-weight:900;
    letter-spacing:.08em;
    font-size:1.7rem;
    margin-bottom:1.5rem;
    color:#2b3220;
  }

  /* Summary card */
  .loyalty-summary{
    background:linear-gradient(135deg,#f7f6ee,#ece7d1);
    border-radius:18px;
    border:2px solid #d6d2b7;
    padding:18px 22px;
  }
  .loyalty-summary-block{
    min-width:150px;
  }
  .loyalty-label{
    font-size:.8rem;
    text-transform:uppercase;
    letter-spacing:.08em;
    color:#7b8063;
    margin-bottom:.2rem;
  }
  .loyalty-value-main{
    font-size:2.1rem;
    font-weight:900;
    color:#2b3220;
  }
  .loyalty-value-sub{
    font-size:1.1rem;
    font-weight:700;
    color:#3f4630;
  }

  /* Table card */
  .loyalty-card{
    border-radius:18px;
    border:2px solid #dfddc8;
    overflow:hidden;
  }
  .loyalty-table thead{
    background:#f5f4ef;
    border-bottom:2px solid #e1dfcc;
  }
  .loyalty-table th{
    font-size:.85rem;
    text-transform:uppercase;
    letter-spacing:.06em;
    color:#777b5b;
  }
  .loyalty-table tbody tr{
    border-color:#ece9d5;
  }
  .loyalty-table tbody tr:hover{
    background:#faf8f1;
  }
  .loyalty-date{
    font-weight:600;
    color:#444a30;
  }
  .loyalty-desc-main{
    font-weight:500;
    color:#303522;
  }
  .loyalty-desc-sub{
    font-size:.8rem;
    color:#8c8f75;
  }
  .points-pos{color:#28a745;font-weight:700;}
  .points-neg{color:#c73939;font-weight:700;}
</style>
{% endblock %}

{% block content %}
<div class="row g-4">
  <div class="col-lg-3 col-md-4">
    {% include 'includes/_sidebar_customer.html' with active='loyalty' %}
  </div>

  <!-- Content -->
  <div class="col-md-9">
    <div class="loyalty-wrap">
      <h1 class="page-title text-center">REWARD POINTS HISTORY</h1>

      <!-- Tổng quan điểm -->
      <div class="loyalty-summary mb-4 d-flex flex-wrap justify-content-between gap-4">
        <div class="loyalty-summary-block">
          <div class="loyalty-label">Current points</div>
          <div class="loyalty-value-main">{{ loyalty.current_points|default:0 }}</div>
        </div>
        <div class="loyalty-summary-block">
          <div class="loyalty-label">Total earned</div>
          <div class="loyalty-value-sub">{{ loyalty.points_earned|default:0 }}</div>
        </div>
        <div class="loyalty-summary-block">
          <div class="loyalty-label">Total used</div>
          <div class="loyalty-value-sub">{{ loyalty.points_used|default:0 }}</div>
        </div>
      </div>

      {% if transactions %}
        <div class="card loyalty-card shadow-sm">
          <div class="card-body p-0">
            <table class="table mb-0 align-middle loyalty-table">
              <thead>
                <tr>
                  <th style="width: 170px;">Date</th>
                  <th>Description</th>
                  <th class="text-end" style="width: 120px;">Points</th>
                  <th class="text-end" style="width: 120px;">Balance</th>
                </tr>
              </thead>
              <tbody>
              {% for tx in transactions %}
                <tr>
                  <td class="loyalty-date">
                    {{ tx.created_at|date:"d/m/Y H:i" }}
                  </td>
                  <td>
                    <div class="loyalty-desc-main">
                      {% if tx.description %}
                        {{ tx.description }}
                      {% else %}
                        {% if tx.type == "EARN" %}Earned points
                        {% elif tx.type == "USE" %}Used points
                        {% else %}Adjustment{% endif %}
                      {% endif %}
                    </div>
                    {% if tx.booking_code %}
                      <div class="loyalty-desc-sub">
                        Booking {{ tx.booking_code }}
                      </div>
                    {% endif %}
                  </td>
                  <td class="text-end">
                    {% if tx.points > 0 %}
                      <span class="points-pos">+{{ tx.points }}</span>
                    {% else %}
                      <span class="points-neg">{{ tx.points }}</span>
                    {% endif %}
                  </td>
                  <td class="text-end">{{ tx.balance_after }}</td>
                </tr>
              {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      {% else %}
        <p class="text-muted mb-0">
          Bạn chưa có lịch sử tích lũy / sử dụng điểm nào.
        </p>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
